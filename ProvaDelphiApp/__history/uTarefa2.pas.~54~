unit uTarefa2;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ComCtrls, uThreadProgresso;

type
  TfTarefa2 = class(TForm)
    ProgressBar1: TProgressBar;
    lblThread1: TLabel;
    ProgressBar2: TProgressBar;
    lblThread2: TLabel;
    Edit1: TEdit;
    Edit2: TEdit;
    btnIniciar: TButton;
    btnFechar: TButton;
    lblSleep1: TLabel;
    lblSleep2: TLabel;
    lblContador1: TLabel;
    lblContador2: TLabel;
    procedure btnIniciarClick(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btnFecharClick(Sender: TObject);
    procedure AtualizaProgressBar(ANumero, APosicao: Integer);
  private
    { Private declarations }
    FThread1: TThreadProgresso;
    FThread2: TThreadProgresso;
    procedure DispararThreads;
    procedure DoProgress (const AContador, AIDThread: Integer);
  public
    { Public declarations }
  end;

var
  fTarefa2: TfTarefa2;
const
  STRCONTADOR = 'Contador: %d';

implementation

{$R *.dfm}

procedure TfTarefa2.AtualizaProgressBar(ANumero, APosicao: Integer);
begin
  case ANumero of
    1: ProgressBar1.Position := APosicao;
    2: ProgressBar2.Position := APosicao;
  end;
end;

procedure TfTarefa2.btnIniciarClick(Sender: TObject);
begin
  btnIniciar.Enabled := false;
  btnFechar.Enabled := false;
  try
    DispararThreads;
  finally
    btnIniciar.Enabled := true;
    btnFechar.Enabled := true;
  end;
end;

procedure TfTarefa2.DispararThreads;
var
  strContador: String;
begin
  lblContador1.Caption := Format(STRCONTADOR, [0]);
  lblContador2.Caption := Format(STRCONTADOR, [0]);
  lblContador1.Visible := true;
  lblContador2.Visible := true;

  FThread1 := TThreadprogresso.Create(false);
  with FThread1 do
  begin
    IDThread := 1;
    SleepTime := StrToInt(Edit1.Text);
    OnProgress := DoProgress;
    FreeOnTerminate := true;
  end;

  FThread2 := TThreadprogresso.Create(false);
  with FThread2 do
  begin
    IDThread := 2;
    SleepTime := StrToInt(Edit2.Text);
    OnProgress := DoProgress;
    FreeOnTerminate := true;
  end;

  FThread1.Start;
  FThread2.Start;
end;

procedure TfTarefa2.DoProgress(const AContador, AIDThread: Integer);
begin
  case AIDThread of
    1:
    begin
      ProgressBar1.Position := AContador;
      lblContador1.Caption := Format(strContador, [AContador]);
    end;
    2:
    begin
      ProgressBar2.Position := AContador;
      lblContador2.Caption := Format(strContador, [AContador]);
    end;
  end;
end;

procedure TfTarefa2.btnFecharClick(Sender: TObject);
begin
  ProgressBar1.Position := 100;
end;

procedure TfTarefa2.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  fTarefa2.free;
end;

end.

